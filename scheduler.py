# Purpose: Enable get_price to run only during business hours

import time
import datetime
import schedule
from download_stock_price_from_bursa import get_price

# Only run get price if it is a weekday from 9 to 5
def main():
  dttm = datetime.datetime.now()
  weekno = datetime.datetime.today().weekday()
  at9am = dttm.replace(hour=9, minute=0, second=0, microsecond=0)
  at5pm = dttm.replace(hour=17, minute=0, second=0, microsecond=0)
  company_list= ["0000","0001","0002","0003","0005","0006","0007","0008","0009","0010","0011","0012","0013","0014","0015","0016","0017","0018","0019","0020","0021","0022","0023","0024","0025","0026","0027","0028","0029","0030","0031","0032","0033","0034","0035","0036","0037","0038","0039","0040","0041","0042""0043","0045","0046","0047","0048","0049","0050","0051","0052","0053","0054","0055","0056","0057","0058","0059","0060","0061","0062","0063","0064","0065","0066","0067","0068","0069","0070","0071","0072","0073","0074","0075","0076","0077","0078","0079","0080","0081","0082","0083","0084","0085","0086","0087","0088","0089","0090","0091","0092","0093","0094","0095","0096","0097","0098","0099","0100","0101","0102","0103","0104","0105","0106","0107","0108","0109","0110","0111","0112","0113","0115","0116","0117","0118","0119","0120","0122","0123","0125","0126","0127","0128","0129","0130","0131","0132","0133","0135","0136","0137","0138","0139","0140","0141","0143","0145","0146","0147","0148","0149","0150","0151","0152","0153","0154","0155","0156","0157","0158","0159","0160","0161","0162","0163","0165","0166","0167","0168","0169","0170","0171","0172","0173","0174","0175","0176","0177","0178","0179","0180","0181","0182","0183","0185","0186","0187","0188","0189","0190","0191","0192","0193","0195","0196","0197","0198","0199","0200","0201","0202","0203","0205","0206","0207","0208","0209","0210","0211","0212","0213","0215","0216","0217","0218","0219","0220","0221","0222","0223","0225","0226","0227","0800","0900","1000","1007","1015","1023","1058","1066","1082","1112","1139","1147","1155","1163","1171","1198","1201","1228","1236","1252","1287","1295","1309","1325","1333","1368","1473","1481","1503","1538","1562","1589","1597","1619","1627","1635","1643","1651","1686","1694","1708","1716","1724","1759","1767","1775","1783","1805","1813","1818","1821","1856","1872","1899","1902","1929","1945","1953","1961","1988","1996","2003","2011","2020","2038","2046","2054","2062","2089","2097","2119","2127","2135","2143","2151","2178","2186","2194","2208","2216","2224","2232","2259","2267","2275","2283","2288","2291","2305","2313","2321","2348","2356","2364","2372","2399","2402","2429","2437","2445","2453","2461","2488","2496","2518","2526","2534","2542","2569","2577","2585","2593","2607","2615","2658","2674","2682","2704","2712","2739","2747","2755","2763","2771","2828","2836","2844","2852","2879","2887","2895","2909","2917","2925","2941","2968","2976","2984","2992","3018","3026","3034","3042","3069","3085","3093","3107","3115","3131","3158","3166","3174","3182","3204","3212","3239","3247","3255","3263","3298","3301","3328","3336","3352","3379","3395","3417","3441","3468","3476","3484","3492","3514","3522","3549","3557","3565","3573","3581","3603","3611","3662","3689","3697","3719","3727","3735","3743","3751","3778","3786","3794","3808","3816","3824","3832","3859","3867","3875","3883","3891","3905","3913","3921","3948","3964","3972","3999","4006","4014","4022","4049","4057","4065","4073","4081","4103","4138","4162","4189","4197","4219","4235","4243","4251","4278","4286","4294","4308","4316","4324","4359","4367","4375","4383","4405","4421","4448","4456","4464","4472","4499","4502","4529","4537","4545","4561","4588","4596","4618","4634","4642","4677","4685","4693","4707","4715","4723","4731","4758","4766","4774","4782","4804","4812","4839","4847","4855","4863","4871","4898","4901","4928","4936","4944","4952","4979","4987","4995","5000","5001","5002","5005","5006","5007","5008","5009","5010","5011","5012","5013","5014","5015","5016","5017","5018","5019","5020","5021","5022","5023","5024","5025","5026","5027","5028","5029","5030","5031","5032","5033","5035","5036","5037","5038","5039","5040","5041","5042","5043","5045","5046","5047","5048","5049","5050","5051","5052","5053","5054","5055","5056","5057","5058","5059","5060","5061","5062","5063","5064","5065","5066","5067","5068","5069","5070","5071","5072","5073","5074","5075","5076","5077","5078","5079","5080","5081","5082","5083","5084","5085","5086","5087","5088","5089","5090","5091","5092","5093","5094","5095","5096","5097","5098","5099","5100","5101","5102","5103","5104","5105","5106","5107","5108","5109","5110","5111","5112","5113","5115","5116","5117","5118","5119","5120","5121","5122","5123","5124","5125","5126","5127","5128","5129","5130","5131","5132","5133","5134","5135","5136","5138","5139","5140","5141","5142","5143","5145","5146","5147","5148","5149","5150","5151","5152","5155","5156","5157","5158","5159","5160","5161","5162","5163","5165","5166","5167","5168","5169","5170","5171","5172","5173","5175","5176","5177","5178","5179","5180","5181","5182","5183","5184","5185","5186","5187","5188","5189","5190","5191","5192","5193","5194","5195","5196","5197","5198","5199","5200","5201","5202","5204","5205","5207","5208","5209","5210","5211","5212","5213","5214","5215","5216","5218","5219","5220","5222","5223","5225","5226","5227","5228","5229","5230","5231","5232","5234","5236","5237","5238","5239","5240","5241","5242","5243","5245","5246","5247","5248","5249","5250","5251","5252","5253","5254","5255","5256","5257","5258","5259","5260","5263","5264","5265","5266","5267","5268","5269","5270","5271","5272","5273","5274","5275","5276","5277","5278","5279","5280","5281","5282","5283","5284","5285","5286","5288","5289","5291","5292","5293","5295","5296","5304","5312","5339","5347","5355","5363","5371","5398","5401","5428","5436","5452","5479","5487","5495","5509","5517","5525","5533","5541","5568","5576","5584","5592","5606","5614","5622","5649","5657","5665","5673","5681","5703","5711","5738","5746","5754","5762","5789","5797","5819","5827","5835","5843","5851","5878","5886","5894","5908","5916","5924","5932","5959","5975","5983","6009","6012","6017","6025","6033","6041","6068","6076","6084","6092","6106","6114","6122","6139","6149","6157","6165","6173","6181","6203","6211","6238","6246","6254","6262","6289","6297","6327","6335","6343","6351","6378","6386","6394","6399","6408","6416","6432","6459","6467","6475","6483","6491","6505","6513","6521","6548","6556","6564","6572","6599","6602","6633","6637","6645","6653","6661","6666","6688","6696","6718","6726","6734","6742","6769","6777","6785","6793","6807","6815","6823","6829","6831","6866","6874","6882","6888","6904","6912","6939","6947","6963","6971","6998","7000","7001","7002","7003","7004","7005","7006","7007","7008","7009","7010","7011","7012","7013","7014","7015","7016","7017","7018","7019","7020","7021","7022","7023","7024","7025","7026","7027","7028","7029","7030","7031","7032","7033","7034","7035","7036","7037","7038","7039","7040","7041","7042","7043","7044","7045","7047","7048","7049","7050","7051","7052","7053","7054","7055","7056","7057","7059","7060","7061","7062","7063","7064","7066","7068","7069","7070","7071","7072","7073","7075","7076","7077","7078","7079","7080","7081","7082","7083","7084","7085","7086","7087","7088","7089","7090","7091","7092","7093","7094","7095","7096","7097","7098","7099","7100","7101","7102","7103","7104","7105","7106","7107","7108","7109","7110","7111","7112","7113","7114","7115","7116","7117","7118","7119","7120","7121","7122","7123","7125","7126","7127","7128","7129","7130","7131","7132","7133","7134","7135","7136","7137","7139","7140","7141","7143","7145","7146","7147","7148","7149","7150","7151","7152","7153","7154","7155","7156","7157","7158","7159","7160","7161","7162","7163","7164","7165","7166","7167","7168","7169","7170","7171","7172","7173","7174","7175","7176","7177","7178","7179","7180","7181","7182","7183","7184","7185","7186","7187","7188","7189","7190","7191","7192","7193","7194","7195","7196","7197","7198","7199","7200","7201","7202","7203","7204","7205","7206","7207","7208","7209","7210","7211","7212","7213","7214","7215","7216","7217","7218","7219","7220","7221","7222","7223","7225","7226","7227","7228","7229","7230","7231","7232","7233","7234","7235","7236","7237","7239","7240","7241","7242","7243","7245","7246","7247","7248","7249","7250","7251","7252","7253","7269","7277","7285","7293","7307","7315","7323","7331","7358","7366","7374","7382","7404","7412","7439","7447","7455","7463","7471","7498","7501","7528","7536","7544","7552","7579","7587","7595","7609","7617","7625","7641","7668","7676","7684","7692","7706","7722","7749","7757","7765","7773","7781","7803","7811","7838","7846","7854","7862","7889","7897","7919","7927","7935","7943","7951","7978","7986","7994","8001","8028","8036","8044","8052","8079","8087","8095","8109","8117","8125","8133","8141","8168","8176","8184","8192","8206","8214","8222","8249","8257","8265","8273","8281","8303","8311","8338","8346","8354","8362","8389","8397","8419","8427","8435","8443","8451","8478","8486","8494","8508","8516","8524","8532","8559","8567","8575","8583","8591","8605","8613","8621","8648","8656","8664","8672","8699","8702","8729","8737","8745","8753","8761","8788","8796","8818","8826","8834","8842","8869","8877","8885","8888","8893","8899","8907","8915","8923","8931","8958","8966","8974","8982","9008","9016","9024","9032","9059","9067","9075","9083","9091","9105","9113","9121","9148","9156","9164","9172","9199","9202","9229","9237","9253","9261","9288","9296","9318","9326","9334","9342","9369","9377","9385","9393","9407","9415","9423","9431","9458","9466","9474","9482","9504","9512","9539","9547","9555","9563","9571","9598","9601","9628","9636","9644","9652","9679","9687","9695","9709","9717","9725","9733","9741","9768","9776","9784","9792","9806","9814","9822","9849","9857","9865","9873","9881","9903","9911","9938","9946","9954","9962","9989","9997","9999"]
  if weekno<5:
    if dttm > at9am and dttm < at5pm:
      for company in company_list:
        start_time = time.time()
        print("this turn is"+company)
        get_price(company_cd  = company,
                  in_tbl      = "fin_data5",
                  db_host     = "localhost",
                  db_user     = "bursa_user",
                  db_password = "password",
                  db_database = "bursa_securities",
                  )
        print("--- %s seconds ---" % (time.time() - start_time))

schedule.every(1).minutes.do(main)

while True:
    schedule.run_pending()
    time.sleep(1)

